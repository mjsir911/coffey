% set makeprg=python3\ pdfmark.py\ &&\ pkill\ -SIGHUP\ mupdf\ &&\ :
(pdfmarklib.ps) run

/h {
	783 exch sub
} def

/bd { } def
/bd { /MK << /BC [  0 0 0  ] >> } def

% border color is CIELAB: L: 65.49, a: 61, b: 39, shade: 18%


[
  [
    <<(first) label
      (Taxpayer's first name) userlabel
      10 combtext
      36 97 h 151 18 fbox
      >> formfield

    <<(middle_initial) label
      (M.I.) userlabel
      186 97 h 16 18 fbox
      1 combtext
      >> formfield

    <<(last) label
      (Last Name) userlabel
      201 97 h 226 18 fbox
      15 combtext
      /Q QRightJustified
      {1 /taxpayer.name.first add} autocalc
      >> formfield
  ] <<(name) label parent>> formfield

  <<(ssn) label
    (Taxpayer's social security number) userlabel
    450 97 h 126 18 fbox
    9 combtext
    {1 1 add} autocalc
    >> formfield
] <<(taxpayer) label parent>> formfield orphan

% ----------------

<<(spouse.name.first) label
  10 combtext textfield
  36 133 h 151 18 fbox
  >> formfield orphan

<<
  (spouse.name.middle_initial) label
  186 133 h 16 18 fbox
  1 combtext textfield
  >> formfield orphan

<<
  /Q QRightJustified
  (spouse.name.last) label
  201 133 h 226 18 fbox
  15 combtext textfield
  >> formfield orphan

<<
  (spouse.ssn) label
  450 133 h 126 18 fbox
  9 combtext textfield
  >> formfield orphan

<<
  (mailing.address) label
  36 169 h 256 18 fbox
  17 combtext textfield
  >> formfield orphan

<<
  291 169 h 180 18 fbox
  (mailing.city) label
  12 combtext textfield
  >> formfield orphan

<<
  (mailing.state) label
  470 169 h 31 18 fbox
  2 combtext textfield
  >> formfield orphan


<<
  5 combtext textfield
  500 169 h 76 18 fbox
  (mailing.zip) label
  >> formfield orphan

/y { 802 exch sub } def
/x { 99 sub } def

<<
  17 combtext
  135 x 224 y 255 18 fbox
  (foreign_province) label
  >> formfield orphan

<<
  12 combtext
  389 x 224 y 181 18 fbox
  (foreign_country) label
  >> formfield orphan

<<
  7 combtext
  569 x 224 y 106 18 fbox
  (foreign_postal_code) label
  >> formfield orphan

[
  <<
    237 x 253 y 13 5 fbox
    circlebox
    checkbox
    /AP << /N << /Off {MoonNotesOff} /Yes3 {MoonNotes} >> >>
  >> formfield
  <<
    333 x 253 y 13 5 fbox
    circlebox 
    checkbox
    /AP << /N << /Off {MoonNotesOff} /Yes2 {MoonNotes} >> >>
  >> formfield
  <<
    434 x 253 y 13 5 fbox
    circlebox
    checkbox
    /AP << /N << /Off {MoonNotesOff} /Yes1 {MoonNotes} >> >>
  >> formfield
] <<(return_status) label parent checkbox>> formfield orphan

/state_fund_taxpayer <<
  (state_fund_taxpayer) label
  453 x 274 y 13 5 fbox
  circlebox
  >> formfield dup orphan def

/state_fund_spouse <<
  533 x 274 y 13 5 fbox
  circlebox 
  (state_fund_spouse) label 
  >> formfield dup orphan def

<<(state_fund_total) label 
  1 combtext textfield 
  662 x 263 y 13 16 fbox
  {
    state_fund_taxpayer (Yes) eq { 1 } { 0 } ifelse 
    state_fund_spouse   (Yes) eq { 1 } { 0 } ifelse add
  } autocalc
  >> formfield dup orphan

<<(taxpayer.veteran) label 
  circlebox 
  559 x 294 y 13 5 fbox
  >> formfield orphan


<<(spouse.veteran) label 
  circlebox 
  629 x 294 y 13 5 fbox
  >> formfield orphan

<<(taxpayer.deceased) label 
  circlebox 
  559 x 315 y 13 5 fbox
  >> formfield orphan

<<(spouse.deceased) label 
  circlebox 
  629 x 315 y 13 5 fbox
  >> formfield orphan


<<(taxpayer.under_18) label 
  circlebox 
  559 x 335 y 13 5 fbox
  >> formfield orphan

<<(spouse.under_18) label 
  circlebox 
  629 x 335 y 13 5 fbox
  >> formfield orphan

<<
  circlebox 
  661 x 356 y 13 5 fbox
  (name_change) label 
  >> formfield orphan
<<
  circlebox 
  661 x 367 y 13 5 fbox
  (nocustodial_parent) label 
  >> formfield orphan
<<
  circlebox 
  661 x 378 y 13 5 fbox
  (schedule_TDS) label 
  >> formfield orphan

[
  <<
    136 x 409 y 13 5 fbox
    circlebox 
    checkbox
    /AP << /N << /Off {MoonNotesOff} /Non {MoonNotes} >> >>
    >> formfield

  <<
    circlebox 
    216 x 409 y 13 5 fbox
    checkbox
    /AP << /N << /Off {MoonNotesOff} /Part {MoonNotes} >> >>
    >> formfield
  <<
    circlebox 
    314 x 409 y 13 5 fbox
    checkbox
    /AP << /N << /Off {MoonNotesOff} /Both {MoonNotes} >> >>
    >> formfield
  <<
    circlebox 
    510 x 409 y 13 5 fbox
    checkbox
    /AP << /N << /Off {MoonNotesOff} /Composite {MoonNotes} >> >>
    >> formfield
] <<(residency_status) label parent checkbox>> formfield orphan

<<
  8 combtext
  450 423 h 101 17 fbox
  (income) label
  /Q QRightJustified
  >> formfield orphan


<<
  8 combtext
  450 444 h 101 17 fbox
  (gross_income) label
  /Q QRightJustified
  >> formfield orphan


[
  << circlebox checkbox 151 x 508 y 15 7 fbox /AP << /N << /Off {MoonNotesOff} /Single {MoonNotes} >> >> >> formfield
  << circlebox checkbox 151 x 519 y 15 7 fbox /AP << /N << /Off {MoonNotesOff} /Married_Joint {MoonNotes} >> >> >> formfield
  << circlebox checkbox 151 x 530 y 15 7 fbox /AP << /N << /Off {MoonNotesOff} /Married_Separate {MoonNotes} >> >> >> formfield
  << circlebox checkbox 151 x 541 y 15 7 fbox /AP << /N << /Off {MoonNotesOff} /HoH {MoonNotes} >> >> >> formfield
  << circlebox checkbox 308 x 541 y 15 7 fbox /AP << /N << /Off {MoonNotesOff} /Custodial {MoonNotes} >> >> >> formfield
] <<(filing_status) label parent checkbox>> formfield orphan

<<
  2 combtext textfield
  350 548 h 26 17 fbox
  (resident_start_month) label
  /Q QRightJustified
  >> formfield orphan

<<
  2 combtext textfield
  375 548 h 26 17 fbox
  (resident_start_day) label
  /Q QRightJustified
  >> formfield orphan

<<
  4 combtext textfield
  400 548 h 51 17 fbox
  (resident_start_year) label
  >> formfield orphan

<<
  2 combtext textfield
  475 548 h 26 17 fbox
  (resident_end_month) label
  /Q QRightJustified
  >> formfield orphan


<<
  2 combtext textfield
  500 548 h 26 17 fbox
  (resident_end_day) label
  /Q QRightJustified
  >> formfield orphan

<<
  4 combtext textfield
  525 548 h 51 17 fbox
  (resident_end_year) label
  >> formfield orphan

<<
  3 combtext textfield
  % Can this be autocalculated / autofilled? its a stretch
  (residency_duration) label
  429 568 h 38 17 fbox
  % { /resident_end_year   /resident_end_month   /resident_end_day   date
  %   /resident_start_year /resident_start_month /resident_start_day date
  %   sub 86400000 div round }

  /AA << /C << /JS 
    ( event.target.value=Math.floor\(
      \(\(new Date\(this.getField\('resident_end_year'\).value, this.getField('resident_end_month').value - 1, this.getField('resident_end_day').value\)\) -
      \(new Date\(this.getField('resident_start_year').value, this.getField('resident_start_month').value - 1, this.getField('resident_start_day').value\)\)\)
      / 86400000
    \)) 
  /S /JavaScript >> >>
  /Q QRightJustified
  >> formfield dup orphan

<<
  (residency_duration_ratio) label
  4 combtext textfield
  525 568 h 51 17 fbox
  % probably to complicated to compile from postscript
  /AA << /C << /JS (event.target.value = \(this.getField('residency_duration').value / 365\).toFixed(4).split(".") [1] ) /S /JavaScript >> >>
  /Q QRightJustified
  >> formfield orphan

[
  [ 
    <<
      (month) label
      textfield
      249 686 h 15 15 fbox
      /Q QCenterJustified
      >> formfield

    <<
      (day) label
      textfield
      269 686 h 15 15 fbox
      /Q QCenterJustified
      >> formfield

    <<
      (year) label
      textfield
      287 686 h 25 15 fbox
      /Q QCenterJustified
      >> formfield
  ] <<(date) label parent>> formfield
]
<<(signature) label
  parent
  textfield
  signature
  80 678 h 167 22 fbox
  >> formfield orphan

[
  [ 
    <<(month) label
      textfield
      2 combtext numtext
      521 686 h 15 15 fbox
      >> formfield

    <<(day) label
      textfield
      2 combtext numtext
      541 686 h 15 15 fbox
      >> formfield

    <<(year) label
      textfield
      4 combtext numtext
      559 686 h 25 15 fbox
      >> formfield
  ] <<(date) label parent>> formfield
] <<(spouse.signature) label
  parent
  textfield
  signature
  358 678 h 162 22 fbox
  >> formfield orphan

<<
  (email) label
  textfield
  107 703 h 312 22 fbox
  >> formfield orphan

<<
  (phone) label
  textfield
  493 703 h 88 22 fbox
  >> formfield orphan

quit

showpage


[  /Subtype /Widget
	/Rect [ 18 94 h 169 112 h ]
	/F 4
	/FT /Tx
	/T (taxpayer.name.first)
	bd
	/Ff 1 24 bitshift
	/MaxLen 10
	/ANN pdfmark

[  /Subtype /Widget
	/Rect [ 168 94 h 184 112 h ]
	/F 4
	/FT /Tx
	/T (taxpayer.name.middle_initial)
	bd
	/Ff 1 24 bitshift
	/MaxLen 1
	/ANN pdfmark

[  /Subtype /Widget
	/Rect [ 183 94 h 409 112 h ]
	/F 4
	/FT /Tx
	/T (taxpayer.name.last)
	bd
	/Q 2
	/Ff 1 24 bitshift
	/MaxLen 15
	/ANN pdfmark

[  /Subtype /Widget
	/Rect [ 558 94 h 432 112 h ]
	/F 4
	/FT /Tx
	/T (taxpayer.ssn) 
	bd
	/Ff 1 24 bitshift
	/MaxLen 9
	/ANN pdfmark

/y { 1625 exch sub } def
/x { 99 sub } def

/personal_exemptions [ mkobj << >> 4 combtext numtext 582 x 979 y 51 15 fbox (Polygon3126) label dict2pdfmark /ANN pdfmark def
[ << >> 2 combtext numtext 472 x 1000 y 24 16 fbox (Polygon3219) label dict2pdfmark /ANN pdfmark
/dependant_exemptions [ mkobj << >> 5 combtext numtext 569 x 1000 y 63 15 fbox (Polygon3233) label dict2pdfmark /ANN pdfmark def
[ << >> circlebox 245 x 1031 y 13 5 fbox (Polygon3265) label dict2pdfmark /ANN pdfmark
[ << >> circlebox 299 x 1031 y 13 5 fbox (Polygon3270) label dict2pdfmark /ANN pdfmark

/num_dependants [ mkobj << >> 1 combtext numtext 484 x 1020 y 12 16 fbox (Polygon3310) label dict2pdfmark /ANN pdfmark cvlit def

num_dependants == quit

/age_exemptions [ 
  mkobj << >> 4 combtext numtext 582 x 1020 y 51 15 fbox (Polygon3325) label 
  { num_dependants 1000 mul } autocalc =
  dict2pdfmark /ANN pdfmark def

[ << >> circlebox 245 x 1051 y 13 5 fbox (Polygon3345) label dict2pdfmark /ANN pdfmark
[ << >> circlebox 299 x 1051 y 13 5 fbox (Polygon3350) label dict2pdfmark /ANN pdfmark
[ << >> 1 combtext numtext 484 x 1041 y 12 16 fbox (Polygon3390) label dict2pdfmark /ANN pdfmark
[ << >> 4 combtext numtext 582 x 1041 y 51 15 fbox (Polygon3404) label dict2pdfmark /ANN pdfmark
[ << >> 6 combtext numtext 557 x 1061 y 76 16 fbox (Polygon3522) label dict2pdfmark /ANN pdfmark
[ << >> 6 combtext numtext 557 x 1082 y 76 16 fbox (Polygon3640) label dict2pdfmark /ANN pdfmark
{ personal_exemptions dependant_exemptions age_exemptions add add } ==
[ mkobj << >> 6 combtext numtext 557 x 1102 y 76 16 fbox (Polygon3753) label dict2pdfmark
/AA << /C << /JS (event.target.value = this.getField('Polygon3126').value + this.getField('Polygon3233').value + this.getField('Polygon3325').value ) /S /JavaScript >> >>
/ANN pdfmark
[ {CO} 3 -1 roll /APPEND pdfmark
[ << >> 8 combtext 532 x 1166 y 101 16 fbox (Polygon4295) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 532 x 1187 y 101 16 fbox (Polygon4410) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 148 x 1221 y 101 16 fbox (Polygon4520) label dict2pdfmark /ANN pdfmark
[ << >> 3 combtext 298 x 1221 y 38 16 fbox (Polygon4533) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 532 x 1221 y 101 16 fbox (Polygon4578) label dict2pdfmark /ANN pdfmark
[ << >> 9 combtext 148 x 1255 y 116 16 fbox (Polygon4666) label dict2pdfmark /ANN pdfmark
[ << >> 9 combtext 314 x 1255 y 116 16 fbox (Polygon4681) label dict2pdfmark /ANN pdfmark
[ << >> 9 combtext 517 x 1255 y 116 16 fbox (Polygon4699) label dict2pdfmark /ANN pdfmark
[ << >> 9 combtext 517 x 1275 y 116 16 fbox (Polygon4816) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 532 x 1296 y 101 16 fbox (Polygon4933) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 532 x 1316 y 101 16 fbox (Polygon5048) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 532 x 1337 y 101 16 fbox (Polygon5163) label dict2pdfmark /ANN pdfmark
[ << >> 9 combtext 517 x 1357 y 116 16 fbox (Polygon5268) label dict2pdfmark /ANN pdfmark
[ << >> circlebox 171 x 1422 y 13 5 fbox (Polygon5606) label dict2pdfmark /ANN pdfmark
[ << >> circlebox 256 x 1422 y 13 5 fbox (Polygon5619) label dict2pdfmark /ANN pdfmark
[ << >> circlebox 316 x 1422 y 13 5 fbox (Polygon5626) label dict2pdfmark /ANN pdfmark
[ << >> circlebox 375 x 1422 y 13 5 fbox (Polygon5633) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 532 x 1432 y 101 16 fbox (Polygon5748) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 532 x 1452 y 101 16 fbox (Polygon5865) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 532 x 1473 y 101 16 fbox (Polygon5977) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 532 x 1493 y 101 16 fbox (Polygon6092) label dict2pdfmark /ANN pdfmark
[ << >> 4 combtext 607 x 1514 y 50 16 fbox (Polygon6223) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 532 x 1534 y 101 16 fbox (Polygon6330) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 532 x 1555 y 101 16 fbox (Polygon6446) label dict2pdfmark /ANN pdfmark


showpage
