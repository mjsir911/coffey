% set makeprg=python3\ pdfmark.py\ &&\ pkill\ -SIGHUP\ mupdf\ &&\ :
(pdfmarklib.ps) run

/h {
	783 exch sub
} def

/bd { } def
/bd { /MK << /BC [  0 0 0  ] >> } def

% border color is CIELAB: L: 65.49, a: 61, b: 39, shade: 18%


[
  [
    <<(first) label
      (Taxpayer's first name) userlabel
      10 combtext
      36 97 h 151 18 fbox
      >> formfield

    <<(middle_initial) label
      (M.I.) userlabel
      186 97 h 16 18 fbox
      1 combtext
      >> formfield

    <<(last) label
      (Last Name) userlabel
      201 97 h 226 18 fbox
      15 combtext
      /Q QRightJustified
      {1 {taxpayer.name.first} add} autocalc
      >> formfield dup /marco_test exch def
  ] <<(name) label parent>> formfield

  <<(ssn) label
    (Taxpayer's social security number) userlabel
    450 97 h 126 18 fbox
    9 combtext
    {1 1 add} autocalc
    >> formfield dup /ssn exch def
] <<(taxpayer) label parent>> formfield orphan

/num_dependants << 8 combtext numtext 450 117 h 126 18 fbox (Polygon3310) label 
  { marco_test 1 add } autocalc
>> formfield dup dup orphan
[ {CO} ssn cvid /APPEND pdfmark
[ {CO} marco_test cvid /APPEND pdfmark
[ {CO} 3 -1 roll cvid /APPEND pdfmark
def

quit


% ----------------

[ << >>
  10 combtext textfield
  (spouse.name.first) label
  36 133 h 151 18 fbox
  dict2pdfmark /ANN pdfmark

[ << >>
  (spouse.name.middle_initial) label
  186 133 h 16 18 fbox
  1 combtext textfield
  dict2pdfmark /ANN pdfmark

[ 
  /Q QRightJustified
  << >>
  (spouse.name.last) label
  201 133 h 226 18 fbox
  15 combtext textfield
  dict2pdfmark /ANN pdfmark

[ << >>
  (spouse.ssn) label
  450 133 h 126 18 fbox
  9 combtext textfield
  dict2pdfmark /ANN pdfmark

[ << >>
  (mailing.address) label
  36 169 h 256 18 fbox
  17 combtext textfield
  dict2pdfmark /ANN pdfmark

[ << >>
  291 169 h 180 18 fbox
  (mailing.city) label
  12 combtext textfield
  dict2pdfmark /ANN pdfmark

[ << >>
  (mailing.state) label
  470 169 h 31 18 fbox
  2 combtext textfield
  dict2pdfmark /ANN pdfmark

[ << >>
  5 combtext textfield
  500 169 h 76 18 fbox
  (mailing.zip) label
  dict2pdfmark /ANN pdfmark

/y { 802 exch sub } def
/x { 99 sub } def

[ << >>
  17 combtext
  135 x 224 y 255 18 fbox
  (foreign_province) label
  dict2pdfmark /ANN pdfmark

[ << >>
  12 combtext
  389 x 224 y 181 18 fbox
  (foreign_country) label
  dict2pdfmark /ANN pdfmark

[ << >>
  7 combtext
  569 x 224 y 106 18 fbox
  (foreign_postal_code) label
  dict2pdfmark /ANN pdfmark

[
  mark mkobj
    << >>
    237 x 253 y 13 5 fbox
    circlebox
    checkchild
    dict2pdfmark
    /AP << /N << /Off {MoonNotesOff} /Yes3 {MoonNotes} >> >>
    /ANN pdfmark
  mark mkobj
    << >>
    333 x 253 y 13 5 fbox
    circlebox 
    checkchild
    dict2pdfmark
    /AP << /N << /Off {MoonNotesOff} /Yes2 {MoonNotes} >> >>
    /ANN pdfmark
  mark mkobj 
    << >>
    434 x 253 y 13 5 fbox
    circlebox
    checkchild
    dict2pdfmark
    /AP << /N << /Off {MoonNotesOff} /Yes1 {MoonNotes} >> >>
    /ANN pdfmark
]

[ mkobj
  << >>
  checkparent
  (return_status) label
  dict2pdfmark
  /ANN pdfmark

  pop

[ << >>
  453 x 274 y 13 5 fbox
  circlebox
  (state_fund_taxpayer) label
  dict2pdfmark /ANN pdfmark
[ << >>
  533 x 274 y 13 5 fbox
  circlebox 
  (state_fund_spouse) label 
  dict2pdfmark /ANN pdfmark
[ mkobj << >>
  1 combtext textfield 
  662 x 263 y 13 16 fbox
  (state_fund_total) label 
  dict2pdfmark
  /AA << /C << /JS (event.target.value = \(this.getField\('state_fund_taxpayer'\).value == "Yes" ? 1 : 0\) + \(this.getField\('state_fund_spouse'\).value == "Yes" ? 1 : 0\) ) /S /JavaScript >> >>
  /ANN pdfmark

[ {CO} 3 -1 roll /APPEND pdfmark

[ << >>
  circlebox 
  559 x 294 y 13 5 fbox
  (taxpayer.veteran) label 
  dict2pdfmark /ANN pdfmark
[ << >>
  circlebox 
  629 x 294 y 13 5 fbox
  (spouse.veteran) label 
  dict2pdfmark /ANN pdfmark
[ << >>
  circlebox 
  559 x 315 y 13 5 fbox
  (taxpayer.deceased) label 
  dict2pdfmark /ANN pdfmark
[ << >>
  circlebox 
  629 x 315 y 13 5 fbox
  (spouse.deceased) label 
  dict2pdfmark /ANN pdfmark
[ << >>
  circlebox 
  559 x 335 y 13 5 fbox
  (taxpayer.under_18) label 
  dict2pdfmark /ANN pdfmark
[ << >>
  circlebox 
  629 x 335 y 13 5 fbox
  (spouse.under_18) label 
  dict2pdfmark /ANN pdfmark
[ << >>
  circlebox 
  661 x 356 y 13 5 fbox
  (name_change) label 
  dict2pdfmark /ANN pdfmark
[ << >>
  circlebox 
  661 x 367 y 13 5 fbox
  (nocustodial_parent) label 
  dict2pdfmark /ANN pdfmark
[ << >>
  circlebox 
  661 x 378 y 13 5 fbox
  (schedule_TDS) label 
  dict2pdfmark /ANN pdfmark

 
[
  mark mkobj << >>
    136 x 409 y 13 5 fbox
    circlebox 
    checkchild
    dict2pdfmark
    /AP << /N << /Off {MoonNotesOff} /Non {MoonNotes} >> >>
    /ANN pdfmark

  mark mkobj << >>
    circlebox 
    216 x 409 y 13 5 fbox
    checkchild
    dict2pdfmark
    /AP << /N << /Off {MoonNotesOff} /Part {MoonNotes} >> >>
    /ANN pdfmark
  mark mkobj << >>
    circlebox 
    314 x 409 y 13 5 fbox
    checkchild
    dict2pdfmark
    /AP << /N << /Off {MoonNotesOff} /Both {MoonNotes} >> >>
    /ANN pdfmark
  mark mkobj << >>
    circlebox 
    510 x 409 y 13 5 fbox
    checkchild
    dict2pdfmark
    /AP << /N << /Off {MoonNotesOff} /Composite {MoonNotes} >> >>
    /ANN pdfmark
]

[ mkobj
  << >>
  checkparent
  (residency_status) label
  dict2pdfmark
  /ANN pdfmark

  pop


[ << >>
  8 combtext
  450 423 h 101 17 fbox
  (income) label
  dict2pdfmark 
  /Q QRightJustified
  /ANN pdfmark


[ << >>
  8 combtext
  450 444 h 101 17 fbox
  (gross_income) label
  dict2pdfmark 
  /Q QRightJustified
  /ANN pdfmark



[
  mark mkobj << >> circlebox checkchild 151 x 508 y 15 7 fbox dict2pdfmark /AP << /N << /Off {MoonNotesOff} /Single {MoonNotes} >> >> /ANN pdfmark
  mark mkobj << >> circlebox checkchild 151 x 519 y 15 7 fbox dict2pdfmark /AP << /N << /Off {MoonNotesOff} /Married_Joint {MoonNotes} >> >> /ANN pdfmark
  mark mkobj << >> circlebox checkchild 151 x 530 y 15 7 fbox dict2pdfmark /AP << /N << /Off {MoonNotesOff} /Married_Separate {MoonNotes} >> >> /ANN pdfmark
  mark mkobj << >> circlebox checkchild 151 x 541 y 15 7 fbox dict2pdfmark /AP << /N << /Off {MoonNotesOff} /HoH {MoonNotes} >> >> /ANN pdfmark
  mark mkobj << >> circlebox checkchild 308 x 541 y 15 7 fbox dict2pdfmark /AP << /N << /Off {MoonNotesOff} /Custodial {MoonNotes} >> >> /ANN pdfmark
]

[ mkobj
  << >>
  checkparent
  (filing_status) label
  dict2pdfmark
  /ANN pdfmark

  pop

[ << >>
  2 combtext textfield
  350 548 h 26 17 fbox
  (resident_start_month) label
  dict2pdfmark 
  /Q QRightJustified
  /ANN pdfmark

[ << >>
  2 combtext textfield
  375 548 h 26 17 fbox
  (resident_start_day) label
  dict2pdfmark 
  /Q QRightJustified
  /ANN pdfmark

[ << >>
  4 combtext textfield
  400 548 h 51 17 fbox
  (resident_start_year) label
  dict2pdfmark 
  /ANN pdfmark

[ << >>
  2 combtext textfield
  475 548 h 26 17 fbox
  (resident_end_month) label
  dict2pdfmark 
  /Q QRightJustified
  /ANN pdfmark


[ << >>
  2 combtext textfield
  500 548 h 26 17 fbox
  (resident_end_day) label
  dict2pdfmark 
  /Q QRightJustified
  /ANN pdfmark

[ << >>
  4 combtext textfield
  525 548 h 51 17 fbox
  (resident_end_year) label
  dict2pdfmark 
  /ANN pdfmark

[ mkobj << >>
  3 combtext textfield
  % Can this be autocalculated / autofilled? its a stretch
  (residency_duration) label
  429 568 h 38 17 fbox
  dict2pdfmark 
  /AA << /C << /JS 
    % (app.alert(new Date(doc.getField('resident_start_year').value, doc.getField('resident_start_month').value + 1, doc.getField('resident_start_day').value\).getYear()\)) 
    ( event.target.value=Math.floor\(
      \(\(new Date\(this.getField\('resident_end_year'\).value, this.getField('resident_end_month').value - 1, this.getField('resident_end_day').value\)\) -
      \(new Date\(this.getField('resident_start_year').value, this.getField('resident_start_month').value - 1, this.getField('resident_start_day').value\)\)\)
      / 86400000
    \)) 
  /S /JavaScript >> >>
  % /AA << /V << /JS (this.getField('residency_duration_ratio').value = event.value / 365) /S /JavaScript >> >>
  % /AA << /V << /JS (this.calculate = true) /S /JavaScript >> >>
  /Q QRightJustified
  /ANN pdfmark

[ {CO} 3 -1 roll /APPEND pdfmark

[ mkobj << >>
  (residency_duration_ratio) label
  4 combtext textfield
  525 568 h 51 17 fbox
  dict2pdfmark 
  /AA << /C << /JS (event.target.value = \(this.getField('residency_duration').value / 365\).toFixed(4).split(".") [1] ) /S /JavaScript >> >>
  /Q QRightJustified
  /ANN pdfmark

[ {CO} 3 -1 roll /APPEND pdfmark

[
  [ 
    mark mkobj << >>
      (month) label
      textfield
      249 686 h 15 15 fbox
      dict2pdfmark
      /Q QCenterJustified
      /ANN pdfmark

    mark mkobj << >>
      (day) label
      textfield
      269 686 h 15 15 fbox
      dict2pdfmark
      /Q QCenterJustified
      /ANN pdfmark

    mark mkobj << >>
      (year) label
      textfield
      287 686 h 25 15 fbox
      dict2pdfmark
      /Q QCenterJustified
      /ANN pdfmark
  ]

  mark mkobj
    << >>
    formparent
    (date) label
    dict2pdfmark
    /ANN pdfmark
]

mark mkobj << >>
  (signature) label
  formparent
  textfield
  signature
  80 678 h 167 22 fbox
  dict2pdfmark
  /ANN pdfmark
  pop

[
  [ 
    mark mkobj << >>
      (month) label
      textfield
      521 686 h 15 15 fbox
      dict2pdfmark
      /Q QCenterJustified
      /ANN pdfmark

    mark mkobj << >>
      (day) label
      textfield
      541 686 h 15 15 fbox
      dict2pdfmark
      /Q QCenterJustified
      /ANN pdfmark

    mark mkobj << >>
      (year) label
      textfield
      559 686 h 25 15 fbox
      dict2pdfmark
      /Q QCenterJustified
      /ANN pdfmark
  ]

  mark mkobj
    << >>
    formparent
    (date) label
    dict2pdfmark
    /ANN pdfmark
]

mark mkobj << >>
  (spouse.signature) label
  formparent
  textfield
  signature
  358 678 h 162 22 fbox
  dict2pdfmark
  /ANN pdfmark
  pop

mark << >>
  (email) label
  textfield
  107 703 h 312 22 fbox
  dict2pdfmark
  /ANN pdfmark

mark << >>
  (phone) label
  textfield
  493 703 h 88 22 fbox
  dict2pdfmark
  /ANN pdfmark

showpage


[  /Subtype /Widget
	/Rect [ 18 94 h 169 112 h ]
	/F 4
	/FT /Tx
	/T (taxpayer.name.first)
	bd
	/Ff 1 24 bitshift
	/MaxLen 10
	/ANN pdfmark

[  /Subtype /Widget
	/Rect [ 168 94 h 184 112 h ]
	/F 4
	/FT /Tx
	/T (taxpayer.name.middle_initial)
	bd
	/Ff 1 24 bitshift
	/MaxLen 1
	/ANN pdfmark

[  /Subtype /Widget
	/Rect [ 183 94 h 409 112 h ]
	/F 4
	/FT /Tx
	/T (taxpayer.name.last)
	bd
	/Q 2
	/Ff 1 24 bitshift
	/MaxLen 15
	/ANN pdfmark

[  /Subtype /Widget
	/Rect [ 558 94 h 432 112 h ]
	/F 4
	/FT /Tx
	/T (taxpayer.ssn) 
	bd
	/Ff 1 24 bitshift
	/MaxLen 9
	/ANN pdfmark

/y { 1625 exch sub } def
/x { 99 sub } def

/personal_exemptions [ mkobj << >> 4 combtext numtext 582 x 979 y 51 15 fbox (Polygon3126) label dict2pdfmark /ANN pdfmark def
[ << >> 2 combtext numtext 472 x 1000 y 24 16 fbox (Polygon3219) label dict2pdfmark /ANN pdfmark
/dependant_exemptions [ mkobj << >> 5 combtext numtext 569 x 1000 y 63 15 fbox (Polygon3233) label dict2pdfmark /ANN pdfmark def
[ << >> circlebox 245 x 1031 y 13 5 fbox (Polygon3265) label dict2pdfmark /ANN pdfmark
[ << >> circlebox 299 x 1031 y 13 5 fbox (Polygon3270) label dict2pdfmark /ANN pdfmark

/num_dependants [ mkobj << >> 1 combtext numtext 484 x 1020 y 12 16 fbox (Polygon3310) label dict2pdfmark /ANN pdfmark cvlit def

num_dependants == quit

/age_exemptions [ 
  mkobj << >> 4 combtext numtext 582 x 1020 y 51 15 fbox (Polygon3325) label 
  { num_dependants 1000 mul } autocalc =
  dict2pdfmark /ANN pdfmark def

[ << >> circlebox 245 x 1051 y 13 5 fbox (Polygon3345) label dict2pdfmark /ANN pdfmark
[ << >> circlebox 299 x 1051 y 13 5 fbox (Polygon3350) label dict2pdfmark /ANN pdfmark
[ << >> 1 combtext numtext 484 x 1041 y 12 16 fbox (Polygon3390) label dict2pdfmark /ANN pdfmark
[ << >> 4 combtext numtext 582 x 1041 y 51 15 fbox (Polygon3404) label dict2pdfmark /ANN pdfmark
[ << >> 6 combtext numtext 557 x 1061 y 76 16 fbox (Polygon3522) label dict2pdfmark /ANN pdfmark
[ << >> 6 combtext numtext 557 x 1082 y 76 16 fbox (Polygon3640) label dict2pdfmark /ANN pdfmark
{ personal_exemptions dependant_exemptions age_exemptions add add } ==
[ mkobj << >> 6 combtext numtext 557 x 1102 y 76 16 fbox (Polygon3753) label dict2pdfmark
/AA << /C << /JS (event.target.value = this.getField('Polygon3126').value + this.getField('Polygon3233').value + this.getField('Polygon3325').value ) /S /JavaScript >> >>
/ANN pdfmark
[ {CO} 3 -1 roll /APPEND pdfmark
[ << >> 8 combtext 532 x 1166 y 101 16 fbox (Polygon4295) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 532 x 1187 y 101 16 fbox (Polygon4410) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 148 x 1221 y 101 16 fbox (Polygon4520) label dict2pdfmark /ANN pdfmark
[ << >> 3 combtext 298 x 1221 y 38 16 fbox (Polygon4533) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 532 x 1221 y 101 16 fbox (Polygon4578) label dict2pdfmark /ANN pdfmark
[ << >> 9 combtext 148 x 1255 y 116 16 fbox (Polygon4666) label dict2pdfmark /ANN pdfmark
[ << >> 9 combtext 314 x 1255 y 116 16 fbox (Polygon4681) label dict2pdfmark /ANN pdfmark
[ << >> 9 combtext 517 x 1255 y 116 16 fbox (Polygon4699) label dict2pdfmark /ANN pdfmark
[ << >> 9 combtext 517 x 1275 y 116 16 fbox (Polygon4816) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 532 x 1296 y 101 16 fbox (Polygon4933) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 532 x 1316 y 101 16 fbox (Polygon5048) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 532 x 1337 y 101 16 fbox (Polygon5163) label dict2pdfmark /ANN pdfmark
[ << >> 9 combtext 517 x 1357 y 116 16 fbox (Polygon5268) label dict2pdfmark /ANN pdfmark
[ << >> circlebox 171 x 1422 y 13 5 fbox (Polygon5606) label dict2pdfmark /ANN pdfmark
[ << >> circlebox 256 x 1422 y 13 5 fbox (Polygon5619) label dict2pdfmark /ANN pdfmark
[ << >> circlebox 316 x 1422 y 13 5 fbox (Polygon5626) label dict2pdfmark /ANN pdfmark
[ << >> circlebox 375 x 1422 y 13 5 fbox (Polygon5633) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 532 x 1432 y 101 16 fbox (Polygon5748) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 532 x 1452 y 101 16 fbox (Polygon5865) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 532 x 1473 y 101 16 fbox (Polygon5977) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 532 x 1493 y 101 16 fbox (Polygon6092) label dict2pdfmark /ANN pdfmark
[ << >> 4 combtext 607 x 1514 y 50 16 fbox (Polygon6223) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 532 x 1534 y 101 16 fbox (Polygon6330) label dict2pdfmark /ANN pdfmark
[ << >> 8 combtext 532 x 1555 y 101 16 fbox (Polygon6446) label dict2pdfmark /ANN pdfmark


showpage
